$(function() {
  window.img1='';

  $('#efm').parsley();

  $("input").inputmask();

  $('input[type=file]').ace_file_input({
    style:'well',
    btn_choose:'Drop files here or click to choose',
    btn_change:null,
    no_icon:'ace-icon fa fa-cloud-upload',
    droppable:true,
    thumbnail:'large'
  });

  $('select').select2({
    width:'100%',
    placeholder:'Please Select',
    language:'th'
  });

  $('.date-picker').datepicker({
    autoclose: true,
    todayHighlight: true,
  }).next().on(ace.click_event, function(){
    $(this).prev().focus();
  });

  autosize($('textarea'));

  $('.addmore').on('click', function(event) {
    var contrain=$(this).attr('data-con');
    var content=$(this).attr('data-cont');
    var index=$(contrain+">div:last").attr('data-index');
    var data=$(content).clone().appendTo(contrain);
    var point=$(contrain+">div:last").find('input,textarea,select');
    var calenda=$(contrain+">div:last").find('.date-picker');
    $(contrain+">div:last").find('span.select2').remove();
    var select=$(contrain+">div:last").find('select');
    calenda.datepicker({
      autoclose: true,
      todayHighlight: true,
    }).next().on(ace.click_event, function(){
      $(this).prev().focus();
    });
    point.filter('input,textarea').val('');
    point.filter('input').inputmask();
    autosize(point.filter('textarea'));
    select.select2({
      width:'100%',
      placeholder:'Please Select',
      language:'th'
    });
    if (typeof index==='undefined') {
      index=1;
      $(contrain+">div:last").attr('data-index',index);
    }else {
      index=parseInt(index)+1;
      $(contrain+">div:last").attr('data-index',index);
    }
    point.each(function() {
      var mod=$(this).attr('name').replace('0',index);
      $(this).attr('name',mod);
    });
  });
  $('.delete').on('click', function(event) {
    var content=$(this).attr('data-cont');
    $(content).addClass('animated fadeOutDown');
    setTimeout(function () {
      $(content).remove();
    }, 550);
  });

$('input[name=national_format]').on('click init-national-format', function() {
    $('#national-box01').toggle($('#national-format-01').prop('checked'));
}).trigger('init-national-format');

$('input[name=national_format]').on('click init-national-format', function() {
    $('#national-box02').toggle($('#national-format-02').prop('checked'));
}).trigger('init-national-format');

$('input[name=contagious_format]').on('click init-contagious-format', function() {
    $('#contagious-box').toggle($('#contagious-format-yes').prop('checked'));
}).trigger('init-contagious-format');

$('input[name=law_format]').on('click init-law-format', function() {
    $('#law-box').toggle($('#law-format-yes').prop('checked'));
}).trigger('init-law-format');

$('input[name=law2_format]').on('click init-law2-format', function() {
    $('#law2-box').toggle($('#law2-format-yes').prop('checked'));
}).trigger('init-law2-format');

$('input[name=intv_format]').on('click init-intv-format', function() {
    $('#intv-box').toggle($('#intv-format-yes').prop('checked'));
}).trigger('init-intv-format');

$('input[name=friends_format]').on('click init-friends-format', function() {
    $('#friends-box').toggle($('#friends-format-yes').prop('checked'));
}).trigger('init-friends-format');

$('input[name=job_format]').on('click init-job-format', function() {
    $('#job-box').toggle($('#job-format-yes').prop('checked'));
}).trigger('init-job-format');

$('#id-disable-check').on('click', function() {
  var inp = $('#form-input-readonly').get(0);
  if(inp.hasAttribute('disabled')) {
    inp.setAttribute('readonly' , 'true');
    inp.removeAttribute('disabled');
    inp.value="This text field is readonly!";
  }
  else {
    inp.setAttribute('disabled' , 'disabled');
    inp.removeAttribute('readonly');
    inp.value="This text field is disabled!";
  }
});

$('input[name=hco_status]').on('change', function(event) {
  if (this.checked) {
  $('.hco_lj').removeClass('show').addClass('hide').find('input,textarea').val('');
}else {
  $('.hco_lj').removeClass('hide').addClass('show');
}
}).trigger('change');

$('#modal-wizard-container').ace_wizard().on('finished.fu.wizard', function(event) {
  $.post($('meta[name=preview]').prop('content'),{
    _token:$('meta[name="csrf-token"]').prop('content'),
    data:window.btoa($('#efm').serialize()),
    img1:window.img1}).then(function(data) {
    $('.preview').html(data);
    $('#preview').modal('show');
  }, function(erro) {
    console.error(erro.responseText);
    console.error('Error Loading');
  })
});
$('#modal-wizard .wizard-actions .btn[data-dismiss=modal]').removeAttr('disabled');

$('input[name=attachment_pic]').on('change', function(event) {
  var data=new FileReader();
  data.onloadend=function() {
    window.img1=data.result;
  };
  data.readAsDataURL(this.files[0]);
});
});
